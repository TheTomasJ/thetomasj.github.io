(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{s9uL:function(t,e,n){"use strict";n.r(e),n.d(e,"DetailModule",(function(){return M}));var o=n("ofXK"),i=n("3Pt+"),c=n("8vEW"),s=n("AytR"),a=n("fXoL"),r=n("wK2T"),m=n("tyNb"),d=n("IfdK"),l=n("P6wz");const b=function(){return["/feeds"]};function p(t,e){if(1&t){const t=a.Pb();a.Ob(0,"div",4),a.Ob(1,"button",5),a.mc(2,"< Back to list"),a.Nb(),a.Ob(3,"button",6),a.Vb("click",(function(){return a.hc(t),a.Xb(2).editMode=!0})),a.mc(4,"Edit"),a.Nb(),a.Ob(5,"button",6),a.Vb("click",(function(){return a.hc(t),a.Xb(2).deleteFeed()})),a.mc(6,"Delete feed"),a.Nb(),a.Nb()}2&t&&(a.zb(1),a.cc("routerLink",a.dc(1,b)))}function g(t,e){if(1&t){const t=a.Pb();a.Ob(0,"div",7),a.Kb(1,"input",8),a.Kb(2,"textarea",9),a.Ob(3,"button",10),a.Vb("click",(function(){return a.hc(t),a.Xb(2).submit()})),a.mc(4,"Save feed"),a.Nb(),a.Ob(5,"button",11),a.mc(6,"Back"),a.Nb(),a.Nb()}if(2&t){const t=a.Xb(2);a.zb(1),a.cc("formControl",t.formGroup.get("name")),a.zb(1),a.cc("formControl",t.formGroup.get("text")),a.zb(1),a.cc("disabled",!t.formGroup.get("name").value||!t.formGroup.get("text").value),a.zb(2),a.cc("routerLink",a.dc(4,b))}}function h(t,e){if(1&t){const t=a.Pb();a.Ob(0,"div",26),a.Kb(1,"img",27),a.Ob(2,"div",28),a.Ob(3,"div",14),a.Ob(4,"span",29),a.mc(5),a.Nb(),a.Ob(6,"span",30),a.mc(7),a.Yb(8,"date"),a.Nb(),a.Nb(),a.Ob(9,"div",16),a.mc(10),a.Nb(),a.Nb(),a.Ob(11,"div",31),a.Vb("click",(function(){a.hc(t);const n=e.$implicit;return a.Xb(3).deleteComment(n.id)})),a.Kb(12,"img",32),a.Nb(),a.Nb()}if(2&t){const t=e.$implicit,n=a.Xb(3);a.zb(1),a.cc("src","https://api.adorable.io/avatars/120/"+t.name,a.ic),a.zb(4),a.oc("",t.name,", "),a.zb(2),a.nc(a.Zb(8,5,t.timestamp)),a.zb(3),a.oc(" ",t.text," "),a.zb(2),a.cc("src",n.baseHref+"assets/cancel-circle.svg",a.ic)}}function f(t,e){if(1&t&&a.Kb(0,"input",33),2&t){const t=a.Xb(3);a.cc("formControl",t.commentGroup.get("name"))}}function u(t,e){if(1&t){const t=a.Pb();a.Ob(0,"div",12),a.Ob(1,"div",13),a.Ob(2,"div",14),a.mc(3),a.Nb(),a.Ob(4,"div",15),a.mc(5),a.Yb(6,"date"),a.Nb(),a.Ob(7,"div",16),a.mc(8),a.Nb(),a.Ob(9,"div",17),a.Ob(10,"span",18),a.mc(11),a.Nb(),a.Ob(12,"span",19),a.Vb("click",(function(){return a.hc(t),a.Xb(2).likeToggle()})),a.mc(13),a.Nb(),a.Nb(),a.Nb(),a.Ob(14,"div",20),a.Ob(15,"div",21),a.mc(16),a.Nb(),a.kc(17,h,13,7,"div",22),a.Ob(18,"div",23),a.kc(19,f,1,1,"input",24),a.Kb(20,"textarea",25),a.Ob(21,"button",10),a.Vb("click",(function(){return a.hc(t),a.Xb(2).submitComment()})),a.mc(22,"Add comment"),a.Nb(),a.Nb(),a.Nb(),a.Nb()}if(2&t){const t=a.Xb(2);a.zb(3),a.oc(" ",t.fetched.name," "),a.zb(2),a.pc(" ",t.fetched.parsedAuthor,", ",a.Zb(6,11,t.fetched.timestamp)," "),a.zb(3),a.oc(" ",t.fetched.text," "),a.zb(3),a.oc("",t.fetched.likes," Likes"),a.zb(2),a.oc(" ",t.liked?"Remove Like":"Add Like"," "),a.zb(3),a.oc("Comments (",t.fetched.comments.length,")"),a.zb(1),a.cc("ngForOf",t.fetched.comments),a.zb(2),a.cc("ngIf",!t.session.data),a.zb(1),a.cc("formControl",t.commentGroup.get("text")),a.zb(1),a.cc("disabled",!t.commentGroup.get("name").value||!t.commentGroup.get("text").value)}}function O(t,e){if(1&t&&(a.Mb(0),a.kc(1,p,7,2,"div",1),a.kc(2,g,7,5,"div",2),a.kc(3,u,23,13,"ng-template",null,3,a.lc),a.Lb()),2&t){const t=a.gc(4),e=a.Xb();a.zb(1),a.cc("ngIf",!e.editMode),a.zb(1),a.cc("ngIf",e.editMode)("ngIfElse",t)}}let C=(()=>{class t extends c.a{constructor(t,e,n,o,i){super(),this.feeds=t,this.route=e,this.router=n,this.session=o,this.fakeSockets=i,this.baseHref=s.a.baseHref,this.detailID=this.route.snapshot.paramMap.get("id"),this.editMode="new"===this.detailID,this.commentGroup=this.getGroup(),this.commentGroup.patchValue({name:o.displayName})}ngOnInit(){"new"===this.detailID?this.inject(null):this.fetchByID(),this.fakeSockets.feedCommented.pipe(this.takeUntilDestroyed()).subscribe(t=>{var e;t===(null===(e=this.fetched)||void 0===e?void 0:e.id)&&this.fetchByID()})}fetchByID(){this.feeds.getFeed(+this.detailID).pipe(this.takeUntilDestroyed()).subscribe(t=>{this.inject(t)},t=>{this.router.navigateByUrl("/feeds")})}getGroup(){return new i.d({name:new i.b,text:new i.b,timestamp:new i.b,likes:new i.b})}inject(t){if(this.fetched=t,this.formGroup||(this.formGroup=this.getGroup()),t){this.formGroup.patchValue(t);try{this.liked=!!localStorage.getItem("liked"+t.id)}catch(e){console.warn("Could not initialize liked state from LS")}}else this.formGroup.patchValue({name:"",text:"",timestamp:Date.now(),likes:0})}submit(){this.fetched?(Object.assign(this.fetched,this.formGroup.value),this.feeds.updateFeed(Object.assign({},this.fetched)).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.editMode=!1})):(this.formGroup.patchValue({timestamp:Date.now()}),this.feeds.createFeed(this.formGroup.value).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.fakeSockets.simulateFeedCreated(),this.router.navigateByUrl("/feeds")}))}likeToggle(){this.formGroup.get("likes").setValue(this.formGroup.get("likes").value+(this.liked?-1:1)),this.liked=!this.liked;try{this.liked?localStorage.setItem("liked"+this.fetched.id,"true"):localStorage.removeItem("liked"+this.fetched.id)}catch(t){console.warn("Could not set liked state to LS")}this.submit()}submitComment(){this.commentGroup.patchValue({timestamp:Date.now()}),this.feeds.createComment(this.fetched.id,this.commentGroup.value).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.commentGroup.patchValue({text:""}),this.fetchByID()})}deleteComment(t){this.feeds.deleteComment(t).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.fetchByID()})}deleteFeed(){this.feeds.deleteFeed(this.fetched.id).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.router.navigateByUrl("/feeds")})}}return t.\u0275fac=function(e){return new(e||t)(a.Jb(r.a),a.Jb(m.a),a.Jb(m.b),a.Jb(d.a),a.Jb(l.a))},t.\u0275cmp=a.Db({type:t,selectors:[["app-detail"]],features:[a.wb],decls:1,vars:1,consts:[[4,"ngIf"],["class","actions",4,"ngIf"],["class","edit container card",4,"ngIf","ngIfElse"],["normalMode",""],[1,"actions"],[3,"routerLink"],[1,"secondary",3,"click"],[1,"edit","container","card"],["placeholder","Name",3,"formControl"],["placeholder","Text",3,"formControl"],[3,"disabled","click"],[1,"secondary",3,"routerLink"],[1,"display-mode"],[1,"main","card"],[1,"title"],[1,"meta"],[1,"text"],[1,"likes"],[1,"count"],[1,"toggle",3,"click"],[1,"comments","card"],[1,"header"],["class","comment",4,"ngFor","ngForOf"],[1,"new-comment"],["placeholder","Your Name",3,"formControl",4,"ngIf"],["placeholder","Comment text",3,"formControl"],[1,"comment"],[1,"avatar",3,"src"],[1,"comment-data"],[1,"name"],[1,"when"],[1,"remove",3,"click"],[3,"src"],["placeholder","Your Name",3,"formControl"]],template:function(t,e){1&t&&a.kc(0,O,5,3,"ng-container",0),2&t&&a.cc("ngIf",e.formGroup)},directives:[o.j,m.c,i.a,i.e,i.c,o.i],pipes:[o.d],styles:["input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]{display:flex;flex-flow:column}.edit[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}.display-mode[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin-left:-16px;margin-top:-16px}.display-mode[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:16px;margin-left:16px}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{flex:3 1 360px;background-color:var(--bg1);height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:24px;line-height:30px;padding:8px 0}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-weight:700;color:#607d8b;margin-bottom:16px}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .likes[_ngcontent-%COMP%]{margin-top:16px;color:#607d8b}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .likes[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{margin-left:8px;cursor:pointer;font-weight:700;color:#2196f3}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]{flex:1 1 260px;max-width:100%}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-size:18px;margin-bottom:8px}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{padding-bottom:16px;margin-bottom:16px;border-bottom:1px solid var(--bg4);display:flex}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{max-width:36px;max-height:36px;border-radius:8px;margin-right:8px}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-data[_ngcontent-%COMP%]{flex:1}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{padding-top:4px;cursor:pointer}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#607d8b;font-weight:700}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{vertical-align:top}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:120px}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px}.actions[_ngcontent-%COMP%]{display:flex;margin-bottom:24px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}"]}),t})(),M=(()=>{class t{}return t.\u0275mod=a.Hb({type:t}),t.\u0275inj=a.Gb({factory:function(e){return new(e||t)},imports:[[o.b,i.f,m.d.forChild([{path:"",component:C}])]]}),t})()}}]);