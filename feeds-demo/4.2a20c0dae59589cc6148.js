(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{s9uL:function(t,e,n){"use strict";n.r(e),n.d(e,"DetailModule",(function(){return C}));var o=n("ofXK"),i=n("3Pt+"),c=n("8vEW"),s=n("fXoL"),a=n("wK2T"),r=n("tyNb"),m=n("IfdK"),d=n("P6wz");const l=function(){return["/feeds"]};function b(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",4),s.Ob(1,"button",5),s.mc(2,"< Back to list"),s.Nb(),s.Ob(3,"button",6),s.Vb("click",(function(){return s.hc(t),s.Xb(2).editMode=!0})),s.mc(4,"Edit"),s.Nb(),s.Ob(5,"button",6),s.Vb("click",(function(){return s.hc(t),s.Xb(2).deleteFeed()})),s.mc(6,"Delete feed"),s.Nb(),s.Nb()}2&t&&(s.zb(1),s.cc("routerLink",s.dc(1,l)))}function p(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",7),s.Kb(1,"input",8),s.Kb(2,"textarea",9),s.Ob(3,"button",10),s.Vb("click",(function(){return s.hc(t),s.Xb(2).submit()})),s.mc(4,"Save feed"),s.Nb(),s.Ob(5,"button",11),s.mc(6,"Back"),s.Nb(),s.Nb()}if(2&t){const t=s.Xb(2);s.zb(1),s.cc("formControl",t.formGroup.get("name")),s.zb(1),s.cc("formControl",t.formGroup.get("text")),s.zb(1),s.cc("disabled",!t.formGroup.get("name").value||!t.formGroup.get("text").value),s.zb(2),s.cc("routerLink",s.dc(4,l))}}function g(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",26),s.Kb(1,"img",27),s.Ob(2,"div",28),s.Ob(3,"div",14),s.Ob(4,"span",29),s.mc(5),s.Nb(),s.Ob(6,"span",30),s.mc(7),s.Yb(8,"date"),s.Nb(),s.Nb(),s.Ob(9,"div",16),s.mc(10),s.Nb(),s.Nb(),s.Ob(11,"div",31),s.Vb("click",(function(){s.hc(t);const n=e.$implicit;return s.Xb(3).deleteComment(n.id)})),s.Kb(12,"img",32),s.Nb(),s.Nb()}if(2&t){const t=e.$implicit;s.zb(1),s.cc("src","https://api.adorable.io/avatars/120/"+t.name,s.ic),s.zb(4),s.oc("",t.name,", "),s.zb(2),s.nc(s.Zb(8,4,t.timestamp)),s.zb(3),s.oc(" ",t.text," ")}}function h(t,e){if(1&t&&s.Kb(0,"input",33),2&t){const t=s.Xb(3);s.cc("formControl",t.commentGroup.get("name"))}}function f(t,e){if(1&t){const t=s.Pb();s.Ob(0,"div",12),s.Ob(1,"div",13),s.Ob(2,"div",14),s.mc(3),s.Nb(),s.Ob(4,"div",15),s.mc(5),s.Yb(6,"date"),s.Nb(),s.Ob(7,"div",16),s.mc(8),s.Nb(),s.Ob(9,"div",17),s.Ob(10,"span",18),s.mc(11),s.Nb(),s.Ob(12,"span",19),s.Vb("click",(function(){return s.hc(t),s.Xb(2).likeToggle()})),s.mc(13),s.Nb(),s.Nb(),s.Nb(),s.Ob(14,"div",20),s.Ob(15,"div",21),s.mc(16),s.Nb(),s.kc(17,g,13,6,"div",22),s.Ob(18,"div",23),s.kc(19,h,1,1,"input",24),s.Kb(20,"textarea",25),s.Ob(21,"button",10),s.Vb("click",(function(){return s.hc(t),s.Xb(2).submitComment()})),s.mc(22,"Add comment"),s.Nb(),s.Nb(),s.Nb(),s.Nb()}if(2&t){const t=s.Xb(2);s.zb(3),s.oc(" ",t.fetched.name," "),s.zb(2),s.pc(" ",t.fetched.parsedAuthor,", ",s.Zb(6,11,t.fetched.timestamp)," "),s.zb(3),s.oc(" ",t.fetched.text," "),s.zb(3),s.oc("",t.fetched.likes," Likes"),s.zb(2),s.oc(" ",t.liked?"Remove Like":"Add Like"," "),s.zb(3),s.oc("Comments (",t.fetched.comments.length,")"),s.zb(1),s.cc("ngForOf",t.fetched.comments),s.zb(2),s.cc("ngIf",!t.session.data),s.zb(1),s.cc("formControl",t.commentGroup.get("text")),s.zb(1),s.cc("disabled",!t.commentGroup.get("name").value||!t.commentGroup.get("text").value)}}function u(t,e){if(1&t&&(s.Mb(0),s.kc(1,b,7,2,"div",1),s.kc(2,p,7,5,"div",2),s.kc(3,f,23,13,"ng-template",null,3,s.lc),s.Lb()),2&t){const t=s.gc(4),e=s.Xb();s.zb(1),s.cc("ngIf",!e.editMode),s.zb(1),s.cc("ngIf",e.editMode)("ngIfElse",t)}}let O=(()=>{class t extends c.a{constructor(t,e,n,o,i){super(),this.feeds=t,this.route=e,this.router=n,this.session=o,this.fakeSockets=i,this.detailID=this.route.snapshot.paramMap.get("id"),this.editMode="new"===this.detailID,this.commentGroup=this.getGroup(),this.commentGroup.patchValue({name:o.displayName})}ngOnInit(){"new"===this.detailID?this.inject(null):this.fetchByID(),this.fakeSockets.feedCommented.pipe(this.takeUntilDestroyed()).subscribe(t=>{var e;t===(null===(e=this.fetched)||void 0===e?void 0:e.id)&&this.fetchByID()})}fetchByID(){this.feeds.getFeed(+this.detailID).pipe(this.takeUntilDestroyed()).subscribe(t=>{this.inject(t)},t=>{this.router.navigateByUrl("/feeds")})}getGroup(){return new i.d({name:new i.b,text:new i.b,timestamp:new i.b,likes:new i.b})}inject(t){if(this.fetched=t,this.formGroup||(this.formGroup=this.getGroup()),t){this.formGroup.patchValue(t);try{this.liked=!!localStorage.getItem("liked"+t.id)}catch(e){console.warn("Could not initialize liked state from LS")}}else this.formGroup.patchValue({name:"",text:"",timestamp:Date.now(),likes:0})}submit(){this.fetched?(Object.assign(this.fetched,this.formGroup.value),this.feeds.updateFeed(Object.assign({},this.fetched)).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.editMode=!1})):(this.formGroup.patchValue({timestamp:Date.now()}),this.feeds.createFeed(this.formGroup.value).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.fakeSockets.simulateFeedCreated(),this.router.navigateByUrl("/feeds")}))}likeToggle(){this.formGroup.get("likes").setValue(this.formGroup.get("likes").value+(this.liked?-1:1)),this.liked=!this.liked;try{this.liked?localStorage.setItem("liked"+this.fetched.id,"true"):localStorage.removeItem("liked"+this.fetched.id)}catch(t){console.warn("Could not set liked state to LS")}this.submit()}submitComment(){this.commentGroup.patchValue({timestamp:Date.now()}),this.feeds.createComment(this.fetched.id,this.commentGroup.value).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.commentGroup.patchValue({text:""}),this.fetchByID()})}deleteComment(t){this.feeds.deleteComment(t).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.fetchByID()})}deleteFeed(){this.feeds.deleteFeed(this.fetched.id).pipe(this.takeUntilDestroyed()).subscribe(()=>{this.router.navigateByUrl("/feeds")})}}return t.\u0275fac=function(e){return new(e||t)(s.Jb(a.a),s.Jb(r.a),s.Jb(r.b),s.Jb(m.a),s.Jb(d.a))},t.\u0275cmp=s.Db({type:t,selectors:[["app-detail"]],features:[s.wb],decls:1,vars:1,consts:[[4,"ngIf"],["class","actions",4,"ngIf"],["class","edit container card",4,"ngIf","ngIfElse"],["normalMode",""],[1,"actions"],[3,"routerLink"],[1,"secondary",3,"click"],[1,"edit","container","card"],["placeholder","Name",3,"formControl"],["placeholder","Text",3,"formControl"],[3,"disabled","click"],[1,"secondary",3,"routerLink"],[1,"display-mode"],[1,"main","card"],[1,"title"],[1,"meta"],[1,"text"],[1,"likes"],[1,"count"],[1,"toggle",3,"click"],[1,"comments","card"],[1,"header"],["class","comment",4,"ngFor","ngForOf"],[1,"new-comment"],["placeholder","Your Name",3,"formControl",4,"ngIf"],["placeholder","Comment text",3,"formControl"],[1,"comment"],[1,"avatar",3,"src"],[1,"comment-data"],[1,"name"],[1,"when"],[1,"remove",3,"click"],["src","../../../assets/cancel-circle.svg"],["placeholder","Your Name",3,"formControl"]],template:function(t,e){1&t&&s.kc(0,u,5,3,"ng-container",0),2&t&&s.cc("ngIf",e.formGroup)},directives:[o.j,r.c,i.a,i.e,i.c,o.i],pipes:[o.d],styles:["input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{margin-bottom:16px}[_nghost-%COMP%]{display:flex;flex-flow:column}.edit[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}.display-mode[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;margin-left:-16px;margin-top:-16px}.display-mode[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{margin-top:16px;margin-left:16px}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]{flex:3 1 360px;background-color:var(--bg1);height:-webkit-fit-content;height:-moz-fit-content;height:fit-content}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{font-size:24px;line-height:30px;padding:8px 0}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .meta[_ngcontent-%COMP%]{font-weight:700;color:#607d8b;margin-bottom:16px}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .likes[_ngcontent-%COMP%]{margin-top:16px;color:#607d8b}.display-mode[_ngcontent-%COMP%]   .main[_ngcontent-%COMP%]   .likes[_ngcontent-%COMP%]   .toggle[_ngcontent-%COMP%]{margin-left:8px;cursor:pointer;font-weight:700;color:#2196f3}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]{flex:1 1 260px;max-width:100%}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .header[_ngcontent-%COMP%]{font-size:18px;margin-bottom:8px}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{padding-bottom:16px;margin-bottom:16px;border-bottom:1px solid var(--bg4);display:flex}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{max-width:36px;max-height:36px;border-radius:8px;margin-right:8px}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .comment-data[_ngcontent-%COMP%]{flex:1}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]{padding-top:4px;cursor:pointer}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{color:#607d8b;font-weight:700}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%] > *[_ngcontent-%COMP%]{vertical-align:top}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{height:120px}.display-mode[_ngcontent-%COMP%]   .comments[_ngcontent-%COMP%]   .remove[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:24px}.actions[_ngcontent-%COMP%]{display:flex;margin-bottom:24px}.actions[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:8px}"]}),t})(),C=(()=>{class t{}return t.\u0275mod=s.Hb({type:t}),t.\u0275inj=s.Gb({factory:function(e){return new(e||t)},imports:[[o.b,i.f,r.d.forChild([{path:"",component:O}])]]}),t})()}}]);